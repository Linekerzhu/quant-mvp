# Features Configuration
# Feature registry with versioning

# Feature version - increment on any change
version: 2  # R19 B2: Updated from v1 to reflect R17-R19 changes

# Feature categories
categories:
  momentum:
    description: Price momentum indicators
    features:
      - name: returns_5d
        description: 5-day log returns
        lookback: 5
      - name: returns_10d
        description: 10-day log returns
        lookback: 10
      - name: returns_20d
        description: 20-day log returns
        lookback: 20
      - name: returns_60d
        description: 60-day log returns
        lookback: 60
      - name: rsi_14
        description: RSI(14)
        lookback: 14
      # R19 B2: Replaced dollar-scale with normalized versions
      - name: macd_line_pct
        description: MACD line as % of price (normalized)
        lookback: 26
      # R22 B2: Replaced signal_pct with histogram_pct (r=0.964 → 0.333)
      - name: macd_histogram_pct
        description: MACD histogram (line - signal) as % of price
        lookback: 35
  
  volatility:
    description: Volatility indicators
    features:
      - name: rv_5d
        description: Realized volatility (5-day)
        lookback: 5
      - name: rv_20d
        description: Realized volatility (20-day)
        lookback: 20
      - name: rv_60d
        description: Realized volatility (60-day)
        lookback: 60
      # R19 B3: Removed atr_20_pct (r=0.897 with rv_20d)
      # Use rv_20d as primary volatility measure instead
  
  volume:
    description: Volume-based indicators
    features:
      - name: relative_volume_20d
        description: Volume vs 20-day average
        lookback: 20
      # R19 B2: Removed obv (500x cross-symbol variance)
      - name: pv_divergence_bull
        description: Price up volume down (weak bullish signal)
        lookback: 5
      - name: pv_divergence_bear
        description: Price down volume down (weak bearish signal)
        lookback: 5
      - name: pv_correlation_5d
        description: Price-volume correlation (5-day rolling)
        lookback: 5
  
  mean_reversion:
    description: Mean reversion indicators
    features:
      - name: price_vs_sma20_zscore
        description: Price vs SMA(20) z-score
        lookback: 20
      - name: price_vs_sma60_zscore
        description: Price vs SMA(60) z-score
        lookback: 60
      # R19 B2: Removed price_vs_ema20_zscore (r=0.97 with sma20_zscore)
  
  market_regime:
    description: Market regime indicators (soft features)
    features:
      - name: vix_change_5d
        description: VIX 5-day change rate (clipped to [-2, 2])
        lookback: 5
      - name: market_breadth
        description: Advance/Decline ratio
        lookback: 1
      - name: adx_14
        description: Average Directional Index (14)
        lookback: 14
      # R19 B2: Removed regime_vol_score (r=0.90 with rv_20d)
      # R19 B2: Removed regime_trend_score (r=0.82 with adx_14)

# Dummy feature for overfitting detection (Plan v4)
dummy_features:
  - name: dummy_noise
    description: Gaussian white noise for overfitting detection
    distribution: "N(0, 1)"
    seed: 42  # For reproducibility
    usage: sentinel_only  # Do not use in actual prediction

# Feature stability monitoring
stability:
  monitoring: true
  ic_lookback: 60  # Days for IC calculation
  drift_threshold: 0.30  # Alert if IC correlation drops 30%

# Feature importance tracking
importance:
  methods:
    - gain
    - shap
  tracking: true
  history_days: 252  # Keep 1 year of importance history

# =============================================================================
# Changelog
# =============================================================================
# R19 (v1 → v2):
# Removed: macd_line, macd_signal, atr_20, obv, regime_vol_score, 
#          regime_trend_score, price_vs_ema20_zscore
# Added: macd_line_pct, macd_signal_pct
#
# R22 (v2):
# Replaced: macd_signal_pct → macd_histogram_pct
# Reason: signal_pct has r=0.964 with line_pct (highly redundant)
#         histogram_pct has r=0.333 with line_pct (better independence)
# =============================================================================
