# Features Configuration
# Feature registry with versioning

# Feature version - increment on any change
version: 1

# Feature categories
categories:
  momentum:
    description: Price momentum indicators
    features:
      - name: returns_5d
        description: 5-day log returns
        lookback: 5
      - name: returns_10d
        description: 10-day log returns
        lookback: 10
      - name: returns_20d
        description: 20-day log returns
        lookback: 20
      - name: returns_60d
        description: 60-day log returns
        lookback: 60
      - name: rsi_14
        description: RSI(14)
        lookback: 14
      - name: macd_line
        description: MACD line (12,26,9)
        lookback: 26
      - name: macd_signal
        description: MACD signal line
        lookback: 35
  
  volatility:
    description: Volatility indicators
    features:
      - name: rv_5d
        description: Realized volatility (5-day)
        lookback: 5
      - name: rv_20d
        description: Realized volatility (20-day)
        lookback: 20
      - name: rv_60d
        description: Realized volatility (60-day)
        lookback: 60
      - name: atr_14
        description: Average True Range (14)
        lookback: 14
  
  volume:
    description: Volume-based indicators
    features:
      - name: relative_volume_20d
        description: Volume vs 20-day average
        lookback: 20
      - name: obv
        description: On-Balance Volume
        lookback: 1  # Cumulative
      # FIX B1: Rename to match actual output from build_features.py
      - name: pv_divergence_bull
        description: Price up volume down (weak bullish signal)
        lookback: 5
      - name: pv_divergence_bear
        description: Price down volume down (weak bearish signal)
        lookback: 5
      - name: pv_correlation_5d
        description: Price-volume correlation (5-day rolling)
        lookback: 5
  
  mean_reversion:
    description: Mean reversion indicators
    features:
      - name: price_vs_sma20_zscore
        description: Price vs SMA(20) z-score
        lookback: 20
      - name: price_vs_sma60_zscore
        description: Price vs SMA(60) z-score
        lookback: 60
      - name: price_vs_ema20_zscore
        description: Price vs EMA(20) z-score
        lookback: 20
  
  market_regime:
    description: Market regime indicators (soft features)
    features:
      - name: vix_change_5d
        description: VIX 5-day change rate
        lookback: 5
      - name: market_breadth
        description: Advance/Decline ratio
        lookback: 1
      # FIX B1: Use numeric scores instead of string labels
      - name: regime_vol_score
        description: Volatility regime score (continuous, 0-1)
        lookback: 20
      - name: regime_trend_score
        description: Trend regime score (continuous, 0-1)
        lookback: 14
      - name: adx_14
        description: Average Directional Index (14)
        lookback: 14

# Dummy feature for overfitting detection (Plan v4)
dummy_features:
  - name: dummy_noise
    description: Gaussian white noise for overfitting detection
    distribution: "N(0, 1)"
    seed: 42  # For reproducibility
    usage: sentinel_only  # Do not use in actual prediction

# Feature stability monitoring
stability:
  monitoring: true
  ic_lookback: 60  # Days for IC calculation
  drift_threshold: 0.30  # Alert if IC correlation drops 30%

# Feature importance tracking
importance:
  methods:
    - gain
    - shap
  tracking: true
  history_days: 252  # Keep 1 year of importance history

# Notes on feature naming alignment:
# - build_features.py outputs: pv_divergence_bull, pv_divergence_bear, pv_correlation_5d
# - build_features.py outputs: regime_vol_score, regime_trend_score, adx_14 (numeric)
# - String columns (regime_volatility, regime_trend, regime_combined) are excluded in _get_feature_columns
